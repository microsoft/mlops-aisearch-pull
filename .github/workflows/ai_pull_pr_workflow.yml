---
name: PR Workflow for AI Search Components

on:
  pull_request:
    branches:
      - 'development'
  workflow_call:

jobs:
  build-validation:
    name: Build Validation
    uses: ./.github/workflows/build_validation_workflow.yml
  deploy-azure-functions:
    name: Azure Functions Deployment
    runs-on: ubuntu-latest
    needs: build-validation
    steps:
      - name: Checkout Actions
        uses: actions/checkout@v1
      - name: Export Secrets
        uses: oNaiPs/secrets-to-env-action@v1
        with:
          secrets: ${{ toJSON(secrets) }}
          convert: upper
      - name: Configure Job Agent
        uses: ./.github/actions/configure_job_agent
    
      - name: Execute Deployment
        uses: ./.github/actions/execute_shell_code
        with:
            azure_credentials: ${{ secrets.azure_credentials }}
            script_parameter: |
                python -m mlops.deployment_scripts.deploy_azure_functions
